<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Advanced JS class</title>
  
  <link rel="stylesheet" href="reveal/css/reveal.min.css">
  <link rel="stylesheet" href="reveal/lib/css/googlecode.css">

  <link rel="stylesheet" href="slides-theme/style.css">
  <link rel="stylesheet" href="slides-theme/talk-specific.css">

  <!-- demos -->

  <!-- for live coding -->
  <link rel="stylesheet" href="js/little-console.css" id="theme">

  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24335480-1']);
  _gaq.push(['_trackPageview']);

  var asyncScript = function(src) {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = src;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  };

  asyncScript(('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js');
  </script>

  <script src="js/revealHooks.js"></script>

</head>

<body>

  <div class="reveal">
    <div class="slides">
<section  class=""><h2 id="js-for-visualisation">JS for Visualisation</h2>
<p>@timruffles</p>
</section>

<section  class=""><h2 id="get-setup">Get setup</h2>
<ul>
<li><a href="https://www.github.com/timruffles/js-and-d3-class">github.com/timruffles/js-and-d3-class</a></li>
</ul>
<p contenteditable>WiFi: </p>

</section>

<section  class=""><h2 id="today">Today</h2>
<blockquote>
<p>Giving you strong core JS skills, ready to tackle modern JS codebases!</p>
</blockquote>
</section>

<section data-state='notitle' class=" notitle"><h2 id="platforms">Platforms</h2>
<p><img src=media/platforms.png></p>
</section>

<section  class=""><h2 id="method">Method</h2>
<ol>
<li>Demo</li>
<li>Exercise</li>
<li>Review exercises at home!</li>
</ol>
</section>

<section  class=""><h2 id="our-guide">Our guide</h2>
<pre><code class="lang-Javascript">// most code examples can be directly pasted
// in browser console

console.log((0, &quot;what does this do?&quot;));
</code></pre>
</section>

<section  class=""><h2 id="ages-of-js">Ages of JS</h2>
<ul>
<li><del>ES3</del> (obsolete)</li>
<li><del>ES5 sloppy</del> (avoid)</li>
<li>ES5 strict</li>
<li>ES.next - ES2015 (ES6), +</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="landscape-diagram">Landscape diagram</h2>
<p><img src="media/es landscape.png"></p>
</section>

<section  class=""><h2 id="strict">Strict</h2>
<pre><code class="lang-javascript">// &lt;- first non-comment line of file or function
&quot;use strict&quot;;

// or: ES6 modules/classes
</code></pre>
</section>

<section  class=""><h2 id="tightens-up-language">Tightens up language</h2>
<ul>
<li>new to JS? Not missing anything!</li>
<li>removes <code>with</code></li>
<li>bans duplicate properties</li>
<li>implicit globals</li>
</ul>
</section>

<section  class=""><h2 id="today-es5-strict-es6">Today: ES5 strict, &amp; ES6</h2>
<p>All code will run in strict, with ES6.</p>
</section>

<section  class=""><h2 id="exercise-intro">Exercise intro</h2>
<pre><code class="lang-sh">./exercises/some-name
  exercise.js
  verify.js
</code></pre>
<pre><code class="lang-sh">cd ./exercises/some-name
node verify
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="core">Core</h2>
</section>

<section  class=""><h2 id="aim">Aim</h2>
<ul>
<li>Effective &quot;programming in the small&quot;</li>
<li>Writing JS like a native</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="designing-in-js">Designing in JS</h2>
</section>

<section  class=""><h2 id="structuring-an-application">Structuring an application</h2>
<blockquote>
<p>Make smaller things.</p>
</blockquote>
<p>Sandii Metz</p>
</section>

<section  class=""><h2 id="lots-of-small-bits">Lots of small bits</h2>
</section>

<section  class=""><h2 id="commonjs">CommonJS</h2>
<p>Node&#39;s module system</p>
</section>

<section  class=""><h2 id="export">Export</h2>
<pre><code class="lang-javascript">// A.js
module.exports.someFunction = function() {
}


module.exports.A_CONSTANT = &quot;hi there&quot;;
</code></pre>
<pre><code class="lang-javascript">// B.js
var myModule = require(&quot;./A.js&quot;);

// myModule is the module.exports from A.js
console.log(myModule.A_CONSTANT) // &quot;hi there&quot;
</code></pre>
</section>

<section  class=""><h2 id="third-party-code">Third-party code</h2>
<pre><code class="lang-javascript">
// this is from core library
var fs = require(&quot;fs&quot;);

// this is looked up from node_modules folders in current,
// and parent directories
var anNpmModule = require(&quot;from-npm&quot;);
</code></pre>
</section>

<section  class=""><h2 id="third-party-vs-local-code">Third-party vs local code</h2>
<pre><code class="lang-javascript">
// either standard library or node_modules
var fs = require(&quot;fs&quot;);

// relative path
var ourCode = require(&quot;../path/to/code&quot;);

// absolute path
var moreCode = require(&quot;/path/to/code&quot;);
</code></pre>
</section>

<section  class=""><h2 id="export-shorthand">Export shorthand</h2>
<pre><code class="lang-javascript">// A.js
exports.someFunction = function() {
}

exports.A_CONSTANT = &quot;hi there&quot;;
</code></pre>
<pre><code class="lang-javascript">// B.js
var myModule = require(&quot;./A.js&quot;);

// myModule is the module.exports from A.js
console.log(myModule.A_CONSTANT) // &quot;hi there&quot;
</code></pre>
</section>

<section  class=""><h2 id="replacing-the-default-export">Replacing the default export</h2>
<pre><code class="lang-javascript">// A.js
module.exports.mainFunction = exports = function main(path) {
}

exports.A_CONSTANT = &quot;hi there&quot;;
</code></pre>
<pre><code class="lang-javascript">// B.js
var myModule = require(&quot;./A.js&quot;);

console.log(myModule.toString) // &quot;function main(path) { ...

console.log(myModule.A_CONSTANT) // &quot;hi there&quot;
</code></pre>
</section>

<section  class=""><h2 id="export">export</h2>
<pre><code class="lang-javascript">⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️
⭐️                                     ⭐️
⭐️      &#39;Behind the scenes&#39;            ⭐️
⭐️ var module = { exports: {} };       ⭐️
⭐️ var exports = module.exports;       ⭐️
⭐️                                     ⭐️
⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️

exports.helper = function() {
}

module.exports = function Main() {
}
</code></pre>
<ul>
  <li>What&#39;s wrong with the code above?</li>
  <li class="fragment">
     We&#39;ve redefined <code>module.exports</code>!
  </li>

  <li class="fragment">
    Original <code>exports</code> object is no longer in module object.
  </li>
</ul>

</section>

<section  class=""><h2 id="let-s-have-a-go-">Let&#39;s have a go!</h2>
<pre><code>exercises/commonjs
</code></pre></section>

<section data-state='title' class=" title"><h2 id="variables">Variables</h2>
</section>

<section  class=""><h2 id="-const-"><code>const</code></h2>
<pre><code class="lang-javascript">const doesNotChange = &quot;hi&quot;;

// throws TypeError - Assignment to constant
doesNotChange = &quot;I&#39;ll try my luck&quot;;
</code></pre>
</section>

<section  class=""><h2 id="-const-"><code>const</code></h2>
<pre><code class="lang-javascript">const counter = { count: 0 };

// what happens here?
counter.count += 1;
</code></pre>
</section>

<section  class=""><h2 id="rule-use-const-if-possible">Rule: use <code>const</code> if possible</h2>
<ul>
<li>one less source of bugs</li>
<li>variables stand out</li>
</ul>
</section>

<section  class=""><h2 id="-let-"><code>let</code></h2>
<pre><code class="lang-javascript">let hiThere = &quot;hello&quot;;

if(true) {
  let hiThere = &quot;GOODBYE&quot;;
}

console.log(hiThere) // which?
</code></pre>
</section>

<section  class=""><h2 id="block-scope">Block scope</h2>
<pre><code class="lang-javascript">for(let i = 0; i++; i &lt; 10) {
  console.log(i);
}

// reference error
console.log(i);
</code></pre>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-of-block-scope">Diagram of block scope</h2>
<p><img src="media/block-scopes.png"></p>
</section>

<section  class=""><h2 id="rule-use-let-in-loops-etc">Rule: use <code>let</code> in loops etc</h2>
<ul>
<li>one less source of bugs</li>
<li>clearer where variables belong</li>
</ul>
</section>

<section  class=""><h2 id="what-about-var-">What about <code>var</code>?</h2>
</section>

<section  class=""><h2 id="-var-"><code>var</code></h2>
<pre><code class="lang-javascript">var someVariable;
var anotherVariable = &quot;hello&quot;;
</code></pre>
</section>

<section  class=""><h2 id="-var-function-scoped"><code>var</code> = function scoped</h2>
</section>

<section  class=""><h2 id="function-scope">Function scope</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-of-function-scope">Diagram of function scope</h2>
<p><img src="media/function-scopes.png"></p>
</section>

<section  class=""><h2 id="one-weird-quirk">One weird quirk</h2>
<pre><code class="lang-javascript">function main() {
  // what happens here?
  console.log(i);

  for(var i = 0; i&lt;10; i++) {
    console.log(i);
  }
}
</code></pre>
</section>

<section  class=""><h2 id="hoisting">Hoisting</h2>
<pre><code class="lang-javascript">function main() {
  ⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️
  # this is the &#39;hoisting zone&#39;, where 
  # all var statements are hoisted before invocation
  SCOPE := { i: undefined }

  # NOTE: JUST for intuition - lightning bolt sections
  # are to give intuition for interpreter actions
  ⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️

  console.log(i);

  for(var i = 0; i&lt;10; i++) {
    console.log(i);
  }
}
</code></pre>
</section>

<section  class=""><h2 id="global-scope">Global scope</h2>
<pre><code class="lang-javascript">// browser - sloppy mode
something = &quot;I am global&quot;;


// browser - strict mode
window.something = &quot;I am global&quot;;

// node
global.something = &quot;I am global&quot;;
</code></pre>
</section>

<section  class=""><h2 id="acessing-global-object">Acessing global object</h2>
<pre><code class="lang-javascript">this; // sloppy, outside functions

window; // browser
global; // node
</code></pre>
</section>

<section  class=""><h2 id="-undefined-vs-undeclared"><code>undefined</code> vs undeclared</h2>
</section>

<section  class=""><h2 id="-undefiend-"><code>undefiend</code></h2>
<pre><code class="lang-javascript">var notDefined;

console.log(notDefined); // ?
</code></pre>
</section>

<section  class=""><h2 id="undeclared">Undeclared</h2>
<pre><code class="lang-javascript">var someVar;

console.log(smeVar); // typo, what happens??
</code></pre>
</section>

<section  class=""><h2 id="exercise-">Exercise!</h2>
<pre><code>exercises/variables-and-scopes
</code></pre></section>

<section data-state='title' class=" title"><h2 id="primitives">Primitives</h2>
</section>

<section  class=""><h2 id="string">String</h2>
<pre><code class="lang-javascript">var name = &#39;Tim&#39;;
var description = &quot;It&#39;s saving escapes&quot;;

var complete = `${name}: ${opinion}`;
</code></pre>
</section>

<section  class=""><h2 id="interpolation-">Interpolation: <code>${}</code></h2>
<pre><code class="lang-javascript">var opinionOnEs6 = &quot;much nicer&quot;;
var es6 = `Interpolation: &#39;${opinion}&#39;`;

var opinionOnEs5 = &quot;looks ugly&quot;;
var es5 = &quot;Interpolation: &#39;&quot; + opinion + &quot;&#39;&quot;;
</code></pre>
</section>

<section  class=""><h2 id="template-strings">Template strings</h2>
<pre><code class="lang-javascript">var es5Html = &quot;&lt;h1&gt;Ugh&lt;/h1&gt;&quot; +
  &quot;&lt;p&gt;This is horrid&lt;/p&gt;&quot;;

var howMuch = &quot;Much&quot;;

var html = `
  &lt;h1&gt;Writing HTML with ES.Next&lt;/h1&gt;
  &lt;p&gt;${howMuch} nicer&lt;/p&gt;
`;
</code></pre>
</section>

<section  class=""><h2 id="rule-use-boolean-">Rule: use <code>Boolean</code></h2>
<pre><code class="lang-javascript">var name = &quot;&quot;;
var coerced = Boolean(name);

console.log(coerced) // false
console.log(Boolean(17)) // true

// NOOOOOOOOOO - never wrap primitives
var evil = new Boolean(false);
if(evil) {
  console.log(&quot;I told you to avoid new with primitives&quot;)
}
</code></pre>
</section>

<section  class=""><h2 id="comparison">Comparison</h2>
</section>

<section  class=""><h2 id="-has-issues"><code>==</code> has issues</h2>
<!-- TODO image -->
</section>

<section  class=""><h2 id="rule-always-use-">Rule: always use <code>===</code></h2>
</section>

<section  class=""><h2 id="but-one-place-to-use-">But <em>ONE</em> place to use <code>==</code></h2>
</section>

<section  class=""><h2 id="handling-null-and-undefined-">Handling <code>null</code> and <code>undefined</code></h2>
</section>

<section  class=""><h2 id="-undefined-and-null-"><code>undefined</code> and <code>null</code></h2>
<pre><code class="lang-javascript">var x; // ?

var y = null;
</code></pre>
</section>

<section  class=""><h2 id="-null-undefined-"><code>null</code> &amp; <code>undefined</code></h2>
<ul>
<li>A nuisance since 1995.</li>
<li>I&#39;d stick to <code>undefined</code></li>
</ul>
</section>

<section  class=""><h2 id="-to-the-rescue-"><code>==</code> to the rescue!</h2>
<pre><code>var undefinedNotEqeqeqNull = undefined === null; // false

if(x === null || x === undefined) {
  // what a chore!
}

if(x == null) {
  // equivalent, shorter, nicer
}
</code></pre></section>

<section  class=""><h2 id="rule-use-null-">Rule: use <code>== null</code></h2>
<pre><code class="lang-javascript">var nullish = x == null;
</code></pre>
</section>

<section  class=""><h2 id="-"><code>===</code></h2>
<ol>
<li>Same type?</li>
<li><p>Same value?</p>
</li>
<li><p>Special cases: <code>NaN !== NaN</code></p>
</li>
<li>Objects (non primitives): compares by identity, not value</li>
</ol>
</section>

<section  class=""><h2 id="-"><code>==</code></h2>
<ol>
<li>Objects (non primitives): compares by identity, not value</li>
<li>Beyond that, very complex. Just use for <code>null</code> or <code>undefined</code></li>
</ol>
</section>

<section data-state='title' class=" title"><h2 id="quality">Quality</h2>
</section>

<section  class=""><h2 id="languages-have-gotchas">Languages have gotchas</h2>
<pre><code class="lang-javascript">var launch = new Boolean(false);

if(launch)
  console.log(&quot;launching missiles&quot;);
else
  console.log(&quot;phew&quot;);
  console.log(&quot;peace at last&quot;);

// what is output?
</code></pre>
</section>

<section  class=""><h2 id="eslint">ESLint</h2>
<ul>
<li>linter: clarifies code</li>
<li>blunts some of JS&#39;s nasty gotchas</li>
</ul>
</section>

<section  class=""><h2 id="try-now">Try now</h2>
<pre><code class="lang-sh">npm run lint:all

# per exercise
eslint exercises/some-exercise/exercise.js
</code></pre>
</section>

<section  class=""><h2 id="running-eslint">Running ESLint</h2>
<ul>
<li>Editor plugins</li>
<li>CLI:</li>
</ul>
<pre><code class="lang-sh">npm install --global eslint@latest
eslint path/to/js
</code></pre>
</section>

<section  class=""><h2 id="code-style">Code style</h2>
<pre><code class="lang-js">// brevity at all cost!
yes &amp;&amp; doThing()
</code></pre>
<pre><code class="lang-js">if(yes) {
  doThing();
}
</code></pre>
</section>

<section  class=""><h2 id="boring-to-debate-">Boring to debate!</h2>
</section>

<section  class=""><h2 id="jscs">JSCS</h2>
<ul>
<li>find (&amp; fix) style deviations</li>
<li>makes switching code-bases more plesant</li>
</ul>
</section>

<section  class=""><h2 id="try-now">Try now</h2>
<pre><code class="lang-sh">npm run style:all

# per exercise
npm install --global jscs@latest
jscs exercises/some-exercise/exercise.js

// boredom removal
jscs --fix exercises/some-exercise/exercise.js
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="build-tools">Build tools</h2>
</section>

<section  class=""><h2 id="modules">Modules</h2>
<ul>
<li>still not native</li>
</ul>
</section>

<section  class=""><h2 id="frontend-build">Frontend build</h2>
<ul>
<li>combine modules to single file</li>
<li>minify to reduce size</li>
<li>Source Maps to retain debuggability</li>
</ul>
</section>

<section  class=""><h2 id="backend-build">Backend build</h2>
<ul>
<li>simply transpile</li>
</ul>
</section>

<section  class=""><h2 id="babel">Babel</h2>
<ul>
<li>most popular, big community</li>
<li>other options: Traceur, Closure</li>
</ul>
</section>

<section  class=""><h2 id="transpiler">Transpiler</h2>
<ul>
<li>converts from ES6 code to ES5</li>
<li>plugin architecture: opt in</li>
</ul>
<!-- TODO nice image -->
</section>

<section  class=""><h2 id="fewest-plugins-as-possible">Fewest plugins as possible</h2>
<ul>
<li>faster transpilation</li>
<li>faster code!</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="-"> </h2>
<pre><code class="lang-javascript">function x([a,b]) {
  return (...args) =&gt; args.map(x =&gt; x + a + b);
}
</code></pre>
<p>vs</p>
<pre><code class="lang-javascript">&quot;use strict&quot;;

var _slicedToArray = function () { /* 0.7kb of JS... */ }

function x(_ref) {
  var _ref2 = _slicedToArray(_ref, 2);

  var a = _ref2[0];
  var b = _ref2[1];

  return function () {
    for (var _len = arguments.length, args = Array(_len),
       _key = 0; _key &lt; _len; _key++) {
      args[_key] = arguments[_key];
    }

    return args.map(function (x) {
      return x + a + b;
    });
  };
}
</code></pre>
</section>

<section  class=""><h2 id="e-g">e.g</h2>
<ul>
<li>Node 5 passes 56% of ES6 test suite, so:</li>
</ul>
<pre><code class="lang-sh">&gt; node -v
5.5.0
&gt; npm install --save babel-preset-node5
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="functions">Functions</h2>
<p><img src="slides-theme/img/eval-apply.jpg" style='width:476px; display:block; margin: 0 auto'></p>
</section>

<section  class=""><h2 id="three-ways-to-define">Three ways to define</h2>
</section>

<section  class=""><h2 id="declare">Declare</h2>
<pre><code class="lang-javascript">function add(a,b) {
  return a + b;
}
</code></pre>
</section>

<section  class=""><h2 id="expression">Expression</h2>
<pre><code class="lang-javascript">var add = function(a, b) {
  return a + b;
}
</code></pre>
<ul>
<li>(expression: something assignable)</li>
</ul>
</section>

<section  class=""><h2 id="fat-arrow">Fat-arrow</h2>
<pre><code class="lang-javascript">// note: lack of `return`
var add = (a, b) =&gt; a + b;

// no ( ) for single arg
var id = object =&gt; object.id;

// note: multiple statements requires {} and `return`
var twoStep = (a, b) =&gt; { console.log(a); return b }

// returning just an object requires you provide brackets:
var object = (a, b) =&gt; {{a:1, b:2}}
</code></pre>
<p class=fragment>
- Is a fat-arrow an expression?
</p>

</section>

<section  class=""><h2 id="evaluating-functions">Evaluating functions</h2>
<pre><code class="lang-javascript">var result = add(add(10, 5), 5); 

// steps for JS to evaluate right-hand-side:

//   add(add(10, 5), 5);
//   add(15, 5);
//   20
</code></pre>
</section>

<section  class=""><h2 id="default-parameters">Default parameters</h2>
<pre><code class="lang-javascript">// default parameters
function log(n, base = 10, opts = {}) {
  // ...
}
</code></pre>
</section>

<section  class=""><h2 id="-required-parameters-trick">&#39;Required&#39; parameters trick</h2>
<pre><code class="lang-javascript">// default parameters
function log(n = required(&quot;number&quot;), base = 10) {
  // ...
}

function required(name) {
  throw new Error(name + &quot; is a required argument&quot;);
}
</code></pre>
</section>

<section  class=""><h2 id="named-parameters-via-destructuring">Named parameters via destructuring</h2>
<pre><code class="lang-javascript">function log({ n, base }) {
  return Math.log(n) / Math.log(base);
}


log({ n: 64, base: 4 }) // 3
log({ n: 90, base: 10 }) // 1.954...
</code></pre>
<pre class=fragment>
<code class="lang-javascript ">
// team up with required!
function log({ n = required(&quot;n&quot;), base = required(&quot;base&quot;) }) {
  return Math.log(n) / Math.log(base);
}

function required(name) {
  throw new Error(name + &quot; is a required argument&quot;);
}
</code></pre>


</section>

<section  class=""><h2 id="named-parameters-defaults">Named parameters defaults</h2>
<pre><code class="lang-javascript">function log({ n, base = 2 }) {
  return Math.log(n) / Math.log(base);
}


console.log(log({ n: 8 })) // 3
log() // TypeError: Cannot match against &#39;undefined&#39; or &#39;null&#39;

// How to fix?
</code></pre>
</section>

<section  class=""><h2 id="complete-named-parameters">Complete named parameters</h2>
<pre><code class="lang-javascript">function log({ n, base = 2 } = {}) {
  return Math.log(n) / Math.log(base);
}


console.log(log({ n: 8 })) // 3
log() // NaN
</code></pre>
</section>

<section  class=""><h2 id="variable-length">Variable length</h2>
<pre><code class="lang-javascript">// variable length functions
function sprintf(format, ...args) {
  console.log(format, ...args);
}

const pair = [1,2];

// can use ... in calls too!
sprint(&quot;%s %s&quot;, ...pair);
</code></pre>
</section>

<section  class=""><h2 id="can-do-all-this-in-es5">Can do all this in ES5</h2>
</section>

<section data-state='bad' class=" bad"><h2 id="but-much-uglier">But <em>much</em> uglier</h2>
</section>

<section  class=""><h2 id="-arguments-"><code>arguments</code></h2>
<pre><code class="lang-javascript">function callMe() {
  // who needs parameters?
  console.log(&quot;Hello &quot; + arguments[0]);
}

callMe(&quot;a&quot;);
</code></pre>
</section>

<section  class=""><h2 id="variable-length">Variable length</h2>
<pre><code class="lang-javascript">function describeRace(race, winner) {
  console.log(race + &quot; was won by &quot; + winner + &quot;, beating &quot; 
    + slice(arguments, 2).join(&quot;, &quot;));
}

function slice(arrayLike, start, end) {
  return [].slice.call(arrayLike, start, end);
}

callMe(&quot;a&quot;);
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="exercise-">Exercise!</h2>
<pre><code>exercises/functions-core
</code></pre></section>

<section data-state='title' class=" title"><h2 id="closures">Closures</h2>
</section>

<section  class=""><h2 id="functions-retain-context">Functions retain context</h2>
<ul>
<li>functions retain variables visible where they&#39;re defined</li>
</ul>
</section>

<section  class=""><h2 id="in-detail">In detail</h2>
<ul>
<li>functions see var/let/const in surrounding function</li>
<li>this link remains long after surrounding fn clears</li>
</ul>
</section>

<section  class=""><h2 id="-"> </h2>
<p><img src="media/closures annotated.png"></p>
</section>

<section data-state='notitle' class=" notitle"><h2 id="context">Context</h2>
<p>We can see variables in functions that wrap us (red)</p>
<p><img src="media/closures annotated.png"></p>
</section>

<section data-state='notitle' class=" notitle"><h2 id="privacy">Privacy</h2>
<p>We can&#39;t see variables from inner functions (blue)</p>
<p><img src="media/closures annotated.png"></p>
</section>

<section  class=""><h2 id="coding-interview-spoiler">Coding interview spoiler</h2>
<pre><code class="lang-javascript">var elements = document.querySelectorAll(&quot;button&quot;);

// What is wrong here? How can we solve?
for(var i = 0; i &lt; elements.length; i++) {
  var element = elements[i];
  element.addEventListener(&quot;click&quot;, function() {
    console.log(element.innerHTML);
  });
}
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="exercise">Exercise</h2>
<pre><code>exercise/closures
</code></pre></section>

<section data-state='title' class=" title"><h2 id="ordered-data-structures">Ordered data-structures</h2>
</section>

<section  class=""><h2 id="-array-"><code>Array</code></h2>
</section>

<section  class=""><h2 id="for-ordered-data">For ordered data</h2>
</section>

<section  class=""><h2 id="ordered">Ordered</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters[0] // What would this be?

// ...and this?
primeMinisters[primeMinisters.length - 1] 

// ...and this?
primeMinisters[-1] 

console.log(primeMinisters.length) // 4
</code></pre>
<ul>
  <li class=fragment>Cameron - Array is 0 indexed</li>
  <li class=fragment>Major</li>
  <li class=fragment>undefined - negative indexes not defined</li>
</ul>

</section>

<section  class=""><h2 id="extension">Extension</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters.unshift(&quot;Fry&quot;); // at start
primeMinisters.push(&quot;Thatcher&quot;); // at end


// what did we learn about const?
console.log(primeMinisters.length) // 6

primeMinisters.pop(); // drops end
primeMinisters.shift(); // drops start

console.log(primeMinisters.length) // 4
</code></pre>
</section>

<section  class=""><h2 id="subsets">Subsets</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

const lastLabourGovernment = primeMinisters.slice(1, 3);

 // Blair then Brown
lastLabourGovernment.reverse().join(&quot; then &quot;)

// how does slice() work?
</code></pre>
</section>

<section  class=""><h2 id="sorting">Sorting</h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters.sort();


// [ &#39;Blair&#39;, &#39;Brown&#39;, &#39;Cameron&#39;, &#39;Major&#39; ]
console.log(primeMinisters)

// what can we tell about .sort() and mutation?

// and sort order?
primeMinisters.sort((a,b) =&gt; a.length - b.length)

// [ &#39;Blair&#39;, &#39;Brown&#39;, &#39;Major&#39;, &#39;Cameron&#39; ]
console.log(primeMinisters)
</code></pre>
</section>

<section  class=""><h2 id="-for-in-"><code>for ... in</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

// what... is this allowed?
primeMinisters.metaData = &quot;hi&quot;;

// for ... in will go over all properties of arrays
var initials = [];
for(let i in primeMinisters) {
  initials.push( primeMinisters[i][0] );
}

// what does initials end up as?
</code></pre>
<ul>
  <li class=fragment>C, B, B, M, h. Why?</li>
  <li class=fragment><code>Array</code> can have string properties!</li>
  <li class=fragment><code>for .. in</code> iterates string properties</li>
</ul>


</section>

<section  class=""><h2 id="-for-"><code>for</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

const initials = [];
for(let i = 0, l = primeMinisters.length; i &lt; l; i++) {
  initials[i] = primeMinisters[i][0];
}
</code></pre>
<ul>
<li>likely always fastest</li>
<li>but: ugly. Use <em>only</em> when forced to</li>
<li>your time is much, much more valuable :)</li>
</ul>
</section>

<section  class=""><h2 id="-for-of-"><code>for .. of</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];
primeMinisters.metaData = &quot;hi&quot;;

// ES6 `for ... of` goes over VALUES of iterables
const initials = [];
for(let pm of primeMinisters) {
  initials.push(pm[0]);
}

console.log(initials) // [&quot;C&quot;,&quot;B&quot;,&quot;B&quot;,&quot;M&quot;]
</code></pre>
<ul>
<li>What problem is solved?</li>
</ul>
</section>

<section  class=""><h2 id="rule-avoid-for-in-on-arrays">Rule: avoid <code>for ... in</code> on arrays</h2>
</section>

<section  class=""><h2 id="functional-iteration">Functional iteration</h2>
<pre><code class="lang-javascript">// ES5 &#39;array additions&#39;
const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters.filter((p) =&gt; p[0] === &quot;B&quot;) // [&quot;Brown&quot;,&quot;Blair&quot;];

primeMinisters.map((p) =&gt; p[0]) // [ &quot;C&quot;, &quot;B&quot;, &quot;B&quot;, &quot;M&quot; ]

primeMinisters.reduce((s, e) =&gt; s + &quot;:&quot; + e) // &#39;Cameron:Brown:Blair:Major&#39;
</code></pre>
</section>

<section  class=""><h2 id="functional-iterators">Functional iterators</h2>
<ul>
<li>intention revealing</li>
<li>shorter, less error-prone</li>
</ul>
</section>

<section  class=""><h2 id="remember-compares-by-identity">Remember: compares by identity</h2>
<pre><code class="lang-javascript">const byValue = [1,2] === [1,2]; // false

const couldStringify = JSON.stringify([1,2]) 
  === JSON.stringify([1,2]); // true
</code></pre>
</section>

<section  class=""><h2 id="exercise">Exercise</h2>
<pre><code>exercises/arrays
</code></pre></section>

<section data-state='title' class=" title"><h2 id="key-value-data-structures">Key-value data-structures</h2>
<!-- TODO why do we care? -->
</section>

<section  class=""><h2 id="-object-used-as-dictionary"><code>Object</code> used as dictionary</h2>
<pre><code class="lang-javascript">const enToFr = {};

enToFr.hello = &quot;bonjour&quot;;
enToFr.cheese = &quot;fromage&quot;;

// equivalent
console.log(enToFr.hello);
console.log(enToFr[&quot;hello&quot;]);
</code></pre>
<p>AKA hashmap, associative array, table.</p>
</section>

<section  class=""><h2 id="keys-are-strings-values-any">Keys are strings, values = any</h2>
<pre><code class="lang-javascript">const dict = {};

dict[10] = &quot;ten&quot;;

console.log(dict[&quot;10&quot;]); // &quot;ten&quot;

// general rule: calls toString on non-strings
const convertsToTen = {
  toString: () =&gt; &quot;10&quot;
};

console.log(dict[convertsToTen]); // &quot;ten&quot;
</code></pre>
</section>

<section  class=""><h2 id="-for-in-"><code>for ... in</code></h2>
<pre><code class="lang-javascript">for(const property in Object.values(object)) {
  const value = object[property];
  console.log(`${property}: ${value}`);
}
</code></pre>
</section>

<section  class=""><h2 id="-for-of-"><code>for ... of</code></h2>
<pre><code class="lang-javascript">// objects not iterable by default, so...
for(const [property, value] of entries(object)) {
  console.log(`${property}: ${value}`);
}

// Object.entries(obj) is proposed for future ECMA
</code></pre>
</section>

<section  class=""><h2 id="es6-dynamic-keys">ES6 - dynamic keys</h2>
<pre><code class="lang-javascript">// ES6
function create(property, value) {
  return { [&quot;id:&quot; + property]: value };
}

// ES5
function create(property, value) {
  var o = {};
  o[&quot;id:&quot; + property] = value;
  return o;
}
</code></pre>
</section>

<section  class=""><h2 id="missing-features">Missing features</h2>
<pre><code class="lang-javascript">const dict = {};

dict[1] = &quot;hello&quot;;

// how to count?
console.log(dict.length); // undefined

console.log(Object.keys(dict).length); // slow for very large objects
</code></pre>
</section>

<section  class=""><h2 id="es6-to-the-rescue-">ES6 to the rescue!</h2>
<pre><code class="lang-javascript">const m = new Map;
const o = {};

const a = [1,2];
const b = [1,2];

// assign
m.set(a, &quot;A&quot;);
m.set(b, &quot;B&quot;);

o = {[a]: &quot;A&quot;, [b]: &quot;B&quot;}

console.log(Object.keys(o).length); // 1
console.log(m.size); // 2

// ...why?
</code></pre>
</section>

<section  class=""><h2 id="more-map-">More <code>Map</code></h2>
<pre><code class="lang-javascript">const m = new Map;

const list = [1,2,3];

m.set(list, &quot;A&quot;);
console.log(m.get(list)); // A

console.log(m.get([1,2,3])); // ...?

const m2 = new Map([
  [&quot;list&quot;, &quot;hello&quot;],
  [&quot;boo&quot;, &quot;another key&quot;],
]);
</code></pre>
</section>

<section  class=""><h2 id="maps-for-of-">Maps: <code>for .. of</code></h2>
<pre><code class="lang-javascript">const m = new Map;
m.set(&quot;A&quot;, 1);
m.set(&quot;B&quot;, 2);

for(let i in m) {
  console.log(i) // not called! why?
}

for(let i of m) {
  console.log(i) // [&quot;A&quot;, 1], ...
}

for(let i of m.keys()) {
  console.log(i) // &quot;A&quot;, &quot;B&quot;
}

for(let i of m.values()) {
  console.log(i) // 1, 2
}

m.forEach((v, k) =&gt; console.log(v, k))
</code></pre>
</section>

<section  class=""><h2 id="-set-"><code>Set</code></h2>
<pre><code class="lang-javascript">// ES6 only

const s = new Set;

s.add(1);
console.log(s.has(1)); // ...?

console.log(s.size); // ...?
s.add(1); s.add(1); s.add(1);
console.log(s.size); // ...?

const A = [1,2];
s.add(A);

console.log(s.has(A)); // ...?
console.log(s.has([1,2])); // ...?
</code></pre>
</section>

<section  class=""><h2 id="exercise">Exercise</h2>
<pre><code>exercises/maps-objects-sets
</code></pre></section>

<section data-state='title' class=" title"><h2 id="async">Async</h2>
</section>

<section  class=""><h2 id="async-io">Async IO</h2>
<ul>
<li>ubiquitious in JS</li>
<li>the ecosystem default</li>
<li>vs subset of libraries in Ruby EM, Python Twisted</li>
</ul>
</section>

<section  class=""><h2 id="let-s-compare">Let&#39;s compare</h2>
</section>

<section  class=""><h2 id="synchronous-io">Synchronous IO</h2>
<ul>
<li>AKA &#39;blocking IO&#39;</li>
</ul>
<pre><code class="lang-javascript">1 // we&#39;ll not continue to the next line until the OS
2 // has read the file and provided it back to our process
3 var contents = fs.readFileSync(&quot;/tmp/hello&quot;, &quot;utf8&quot;);
4 
5 console.log(&quot;End of source file&quot;);
</code></pre>
</section>

<section  class=""><h2 id="asynchronous-io">Asynchronous IO</h2>
<ul>
<li>AKA &#39;non-blocking IO&#39;</li>
</ul>
<pre><code class="lang-javascript">1 fs.readFile(&quot;/tmp/hello&quot;, { encoding: &quot;utf8&quot; },
2  function(err, content) {
3    // (2/2) ...we get here
4    console.log(&quot;Read the file&quot;);
5  });
6
7 // (1/2) we&#39;ll get here waaaaaaaaaaaay before...
8 console.log(&quot;End of source file&quot;);
</code></pre>
</section>

<section  class=""><h2 id="clearing-the-stack">Clearing the stack</h2>
<ul>
<li>no code ever runs simultaneously</li>
<li>while code is running, no callbacks fire</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-loop">Diagram loop</h2>
<p><img src="media/event-loop-schematic.png"></p>
</section>

<section  class=""><h2 id="rule-don-t-block-the-loop">Rule: don&#39;t block the loop</h2>
<ul>
<li>avoid long running, synchronous code</li>
<li>chunk</li>
<li>or delegate to other processes/WebWorkers</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-starving-the-lop">Diagram: starving the lop</h2>
<p><img src="media/event-loop.png"></p>
</section>

<section  class=""><h2 id="sources-of-async">Sources of async</h2>
<ul>
<li><code>setTimeout</code></li>
<li>AJAX</li>
<li>IndexedDB, WebWorkers</li>
<li>most Node APIs (<code>fs</code>, <code>child_process</code>)</li>
</ul>
</section>

<section  class=""><h2 id="stacks">Stacks</h2>
<ul>
<li>languages with functions need a stack</li>
<li>keeps point to return to</li>
<li>stack &#39;unravels&#39; with errors</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="stack-diagram">Stack diagram</h2>
<p><img src="media/stack-clear-errors.png"></p>
</section>

<section data-state='notitle' class=" notitle"><h2 id="with-async-no-one-can-hear-you-throw">With async, no one can hear you throw</h2>
<p><img src="media/stack-clear.png"></p>
</section>

<section  class=""><h2 id="e-g">e.g</h2>
<pre><code class="lang-javascript">// this stack is long gone...
try {

  create({}, function() {
    // ...
  })

} catch(e) {
  // never going to catch!
}
// waaaaay before...(1)

function create(data, cb) {
  $post(&quot;/api/create&quot;, data, function(err, ok) {
    if(err) {
      // (1)...we get here
      throw err;
    }
  })
}
</code></pre>
</section>

<section  class=""><h2 id="rule-don-t-throw-in-async">Rule: don&#39;t throw in async</h2>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<pre><code>exercises/callbacks-and-async
</code></pre></section>

<section data-state='title' class=" title"><h2 id="promises">Promises</h2>
</section>

<section  class=""><h2 id="intuition">Intuition</h2>
<p><img src="media/promises.png" alt="Promise chain"></p>
</section>

<section  class=""><h2 id="an-iou">An IOU</h2>
<ul>
<li>A value, available immediately</li>
<li>Settled - resolved or rejected - once</li>
<li>Use before or after settled</li>
</ul>
</section>

<section  class=""><h2 id="promises-in-practice">Promises in practice</h2>
</section>

<section  class=""><h2 id="steps-in-process">Steps in process</h2>
<ul>
<li><code>.then(transformResolve, transformReject)</code></li>
</ul>
<pre><code class="lang-javascript">const user = getUser(params[&quot;id&quot;]);
const profile = user.then(getProfile);
const accountPage = Promise.all([user,profile])
  .then(accountPageTemplate);
</code></pre>
</section>

<section  class=""><h2 id="present-use-value">Present/use value</h2>
<ul>
<li>finally used more like callback</li>
</ul>
<pre><code class="lang-javascript">accountPage.then(
  renderHtml,
  renderErrorMessage
);
</code></pre>
</section>

<section  class=""><h2 id="-then-is"><code>then</code> is</h2>
<ul>
<li>Mostly: recipe for new values</li>
<li>Sometimes: actions when resolved</li>
</ul>
</section>

<section  class=""><h2 id="where-">Where?</h2>
<ul>
<li>ES5: libraries</li>
<li>ES6: built-in</li>
<li>Libraries actually better</li>
</ul>
</section>

<section  class=""><h2 id="promise-tools">Promise tools</h2>
</section>

<section  class=""><h2 id="creating-resolved-promise">Creating resolved promise</h2>
<pre><code class="lang-javascript">Promise.resolve(x)
</code></pre>
<ul>
<li>returns a promise, if x is:</li>
<li>a non-promise, a fulfilled promise for &#39;x&#39;</li>
<li>a promise, that promise</li>
</ul>
</section>

<section  class=""><h2 id="creating-rejected">Creating rejected</h2>
<pre><code>Promise.reject(Error(&quot;some description&quot;))
</code></pre><ul>
<li>returns a rejected promise</li>
<li>should always reject with <code>Error</code> for stacks</li>
</ul>
</section>

<section  class=""><h2 id="groups-of-promises">Groups of promises</h2>
<pre><code>Promise.all([promise, value, promiseB, valueB])
</code></pre><ul>
<li>returns promise for an array with all resolved</li>
<li>works with all iterables (<code>Array</code>, <code>Map</code> etc)</li>
</ul>
</section>

<section  class=""><h2 id="flow-control">Flow control</h2>
<pre><code class="lang-javascript">SomeQuery
  .then(transform)
  .then(function(value) {
    if(!isOk(value)) {
      return Promise.reject(Error(&quot;Not ok!&quot;))
    }

    return someTest(value)) ?
      QueryA(value) : QueryB(value);
  })
  .catch((err) =&gt; Promise.reject(Error(&quot;Query failed: &quot; + err)))
  .finally(function() {
    // anything that happens if resolved/rejected
  });
</code></pre>
</section>

<section  class=""><h2 id="rule-don-t-use-promises-as-callbacks">Rule: don&#39;t use promises as callbacks</h2>
<ul>
<li>until you&#39;re <em>doing</em> something (display etc)</li>
</ul>
</section>

<section  class=""><h2 id="promises-collections">Promises + collections</h2>
<pre><code class="lang-javascript">var userIds = [10,20,30,50,100];

// array of promises
var users = userIds.map(User.get);

// promise for array of [user, account]
var usersWithAccounts = Promise.all(users)
  .then(function(users) {
    return users.map(function(user) {
      return Promise.all([
        user,
        Account.get(user)
      ]);
    });
  });
</code></pre>
</section>

<section  class=""><h2 id="promises-conclusion">Promises conclusion</h2>
<ul>
<li>promises = values for async</li>
<li>don&#39;t just use as callbacks</li>
<li>think chains of transformations</li>
</ul>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<ul>
<li>exercises/promises</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="objects">Objects</h2>
</section>

<section  class=""><h2 id="confusion">Confusion</h2>
</section>

<section  class=""><h2 id="-object-"><code>Object</code></h2>
<pre><code class="lang-javascript">const a = { b: 1 }; // this is an instance of &#39;Object&#39;

// A is an object too!
A.b = 1;
function A() {
}

console.log(typeof null); // object
</code></pre>
</section>

<section data-state='bad' class=" bad"><h2 id="nope">Nope</h2>
</section>

<section  class=""><h2 id="oop">OOP</h2>
<ul>
<li>Object-oriented programming. </li>
<li>Alan Kay&#39;s &#39;objects&#39;</li>
</ul>
<pre><code> The big idea is &quot;messaging&quot;. 
</code></pre></section>

<section  class=""><h2 id="oop-in-js">OOP in JS</h2>
<ul>
<li>ES6: <code>class</code></li>
<li>ES5: prototypes</li>
</ul>
</section>

<section  class=""><h2 id="es6">ES6</h2>
<pre><code class="lang-javascript">class Widget {
  constructor({ model }) {
    this._model = model;
  }

  render() {
    return `&lt;div&gt;${ this._model.get(&quot;name&quot;) }&lt;/div&gt;`;
  }
}

const instance = new Widget({
  model: new Map([[&quot;name&quot;, &quot;crockford&quot;]]),
});
</code></pre>
</section>

<section  class=""><h2 id="let-s-break-it-down">Let&#39;s break it down</h2>
<pre><code class="lang-javascript">class Widget {
  // this is the function invoked when we call &#39;new Widget&#39;
  constructor({ model }) {
    // ... 
  }
}
</code></pre>
</section>

<section  class=""><h2 id="let-s-break-it-down">Let&#39;s break it down</h2>
<pre><code class="lang-javascript">class Widget {
  // ...

  // methods defined here will be callable on the instances
  render() {

  }
}
</code></pre>
</section>

<section  class=""><h2 id="let-s-have-a-go">Let&#39;s have a go</h2>
<pre><code>Exercise 1

exericses/objects-and-prototypes
</code></pre></section>

<section  class=""><h2 id="okay-that-s-the-basics">Okay that&#39;s the basics</h2>
</section>

<section  class=""><h2 id="what-about">What about</h2>
</section>

<section  class=""><h2 id="privacy-">Privacy?</h2>
</section>

<section  class=""><h2 id="consensual-privacy">Consensual privacy</h2>
<pre><code class="lang-javascript">class Widget {

  render() {
    return `&lt;div&gt;${ this._renderName() }&lt;/div&gt;`;
  }

  // prefix to show it&#39;s private
  _renderHelper() {
    return `&lt;span class=&#39;name&#39;&gt;
      ${ this._model.get(&quot;name&quot;) }
    &lt;/span&gt;`;
  }

}

const instance = new Widget(/* ... */);

instance.render();
instance._renderHelper(); // no error
</code></pre>
</section>

<section  class=""><h2 id="inheritence">Inheritence</h2>
<pre><code class="lang-javascript">class DefaultMap extends Map {

  constructor(members, defaulter) {
    super(members);
    this._default = defaulter;
  }

  get(key) {
    if(!this.has(key)) {
      this._default(key, this);<br>    }

    return super.get(key);
  }
}

const instance = new DefaultMap([[&quot;apples&quot;, 7 ]]), 
  () =&gt; 0)

console.log(instance.get(&quot;apples&quot;)) // 7
console.log(instance.get(&quot;pears&quot;)) // 0
</code></pre>
</section>

<section  class=""><h2 id="broken-down">Broken down</h2>
<pre><code class="lang-javascript">class DefaultMap extends Map {

  constructor(members, default) {
    super(members);
    this._default = default;
  }

  // ...
}
</code></pre>
<pre><code class="lang-javascript">// this is the default constructor of a sub-class
constructor(...args) {
  super(...args)
}
</code></pre>
</section>

<section  class=""><h2 id="calling-super-methods">Calling super methods</h2>
<pre><code class="lang-javascript">class DefaultMap extends Map {
  // ...

  get(key) {
    // ...

    return super.get(key);
  }
}
</code></pre>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<pre><code>Exercise 2

exercises/objects-and-prototypes
</code></pre></section>

<section  class=""><h2 id="properties-">Properties?</h2>
<pre><code class="lang-javascript">class Widget {
  something: [];
}
</code></pre>
</section>

<section data-state='bad' class=" bad"><h2 id="nope">Nope</h2>
</section>

<section  class=""><h2 id="deliberate-ommission">Deliberate ommission</h2>
</section>

<section  class=""><h2 id="instead">Instead</h2>
<pre><code class="lang-javascript">class Point {
  constructor(x, y) {
    this.x = x;
    this.y = y;
  }
}
</code></pre>
</section>

<section  class=""><h2 id="why-">Why?</h2>
</section>

<section  class=""><h2 id="well-">Well...</h2>
</section>

<section  class=""><h2 id="how-do-js-objects-really-work-">How do JS objects really work?</h2>
</section>

<section  class=""><h2 id="prototypes-">Prototypes!</h2>
</section>

<section  class=""><h2 id="big-idea">Big idea</h2>
</section>

<section  class=""><h2 id="if-an-object-doesn-t-know-it-asks-its-prototype">If an object doesn&#39;t know, it asks its prototype</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="-"> </h2>
<p><img src="media/prototypes.png"></p>
<!-- TODO explain why on image - i.e that we're reducing repetition -->
</section>

<section  class=""><h2 id="chain">Chain</h2>
<p><img src="media/prototype-chain.png"></p>
</section>

<section  class=""><h2 id="lookup-algorithm">Lookup algorithm</h2>
<pre><code class="lang-javascript">// always at run-time
function getProperty(object, prop) {
  if(object.hasOwnProperty(prop)) {
    return object[prop];
  } else {
    if(object.__proto__) {
      getProperty(object.__proto__, prop);
    } else {
      return undefined;
    }
  }
}
</code></pre>
</section>

<section  class=""><h2 id="-this-on-invocation"><code>this</code> on invocation</h2>
<pre><code class="lang-javascript">const sturcture = {
  squareArea: function() {
    return this.width * this.height;
  },
};

const house = Object.create(structure);
Object.assign(house, {
  width: 5,
  height: 10,
});

house.squareArea() // 50
</code></pre>
</section>

<section  class=""><h2 id="magic-argument-this-">Magic argument <code>this</code></h2>
<pre><code class="lang-javascript">// this = someObject
someObject.someProperty();

const someProperty = this.someObject;

// this = enclosing this, likely global
someProperty();
</code></pre>
</section>

<section  class=""><h2 id="classic-bug">Classic bug</h2>
<pre><code class="lang-javascript">var someObject = {
  name: &quot;lil&#39; listeny&quot;,
  listen: function(el) {
    el.addEventListener(&quot;click&quot;, this.handle)
  },
  handle: function() {
    console.log(this.name);
  },
};

// what do we see console.log&#39;d?
someObject.listen(button);
button.click();
</code></pre>
</section>

<section  class=""><h2 id="how-can-we-fix-">How can we fix?</h2>
</section>

<section  class=""><h2 id="-"><code>=&gt;</code></h2>
<pre><code class="lang-javascript">var someObject = {
  // ...
  listen: function(el) {
    // fat arrow has lexical this! i.e this of current scope
    el.addEventListener(&quot;click&quot;, (e) =&gt; this.handle(e))
  },
  // ...
};
</code></pre>
</section>

<section  class=""><h2 id="let-s-try-">Let&#39;s try!</h2>
<pre><code>Exercise 3

exercises/objects-and-prototypes
</code></pre></section>

<section data-state='title' class=" title"><h2 id="tests">Tests</h2>
</section>

<section  class=""><h2 id="writing-good-software-takes-time">Writing good software takes time</h2>
</section>

<section  class=""><h2 id="js-is-loose">JS is loose</h2>
</section>

<section  class=""><h2 id="tests-dynamic-great-mix">Tests + dynamic: great mix</h2>
</section>

<section  class=""><h2 id="how-do-we-test-">How do we test?</h2>
</section>

<section  class=""><h2 id="how-do-we-test-">How do we <del>test</del>?</h2>
</section>

<section  class=""><h2 id="how-do-we-specify-behaviour-">How do we specify behaviour?</h2>
</section>

<section  class=""><h2 id="documentation-comes-free-">Documentation comes free!</h2>
</section>

<section  class=""><h2 id="1-describe-the-context">1. Describe the context</h2>
<pre><code class="lang-javascript">describe(&quot;user login&quot;, function() {

})
</code></pre>
</section>

<section  class=""><h2 id="2-state-what-it-should-do">2. State what it should do</h2>
<pre><code class="lang-javascript">describe(&quot;user login&quot;, function() {

  it(&quot;starts off with username field focussed&quot;);

  it(&quot;warns if the password is too simple&quot;);

  it(&quot;prevents sumission if invalid&quot;);

})
</code></pre>
</section>

<section  class=""><h2 id="3-implement-assertions-to-ensure-behaviour">3. Implement assertions to ensure behaviour</h2>
<pre><code class="lang-javascript">describe(&quot;user login&quot;, function() {

  it(&quot;starts off with username field focussed&quot;, function() {
    const widget = new Widget();
    widget.render();

    const input = widget.el.find(&quot;[name=username&quot;);

    assert.elementHasFocus(input);
  });

})
</code></pre>
</section>

<section  class=""><h2 id="4-when-tests-fail-you-write-code">4. When tests fail, you write code</h2>
<pre><code class="lang-javascript">class Widget {
  render() {
    // implement
  }
}
</code></pre>
</section>

<section  class=""><h2 id="5-or-new-lower-level-tests">5. Or, new, lower-level tests</h2>
<pre><code class="lang-javascript">// our higher level test may prompt this:

//  it(&quot;starts off with username field focussed&quot;);

describe(&quot;auto-focus component&quot;, function() {
  it(&quot;focusses an input&quot;);

  it(&quot;does not prevent focus leaving the input&quot;);
})
</code></pre>
</section>

<section  class=""><h2 id="also-tests-are-code">Also: tests are code</h2>
</section>

<section  class=""><h2 id="keep-it-dry">Keep it dry</h2>
<pre><code class="lang-javascript">describe(&quot;auto-focus component&quot;, function() {
  let widget;
  beforeEach(function() {
    // put our shared setup in here, save typing
    widget = new Widget();
  });
})
</code></pre>
<!-- TODO TDD loop image -->
</section>

<section  class=""><h2 id="tdd-loop">TDD loop</h2>
<ul>
<li>fail/red: a failing test</li>
<li>code code code!</li>
<li>pass/green: our code passes test</li>
<li>(refactor/performance): with confidence</li>
</ul>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<pre><code>Exercise 1

exercises/testing
</code></pre></section>

<section data-state='title' class=" title"><h2 id="hard-tests">Hard tests</h2>
</section>

<section  class=""><h2 id="e-g">e.g</h2>
<ul>
<li>asynchronous</li>
<li>random</li>
<li>Date/time dependent</li>
</ul>
</section>

<section  class=""><h2 id="aside-async">Aside: async</h2>
<pre><code class="lang-javascript">// callback based - mocha supports promises too
it(&quot;should call&quot;, function(done) {
  somethingAsync(function(url) {
    assert.match(url, /users\/1/)
    done();
  }) 
})
</code></pre>
</section>

<section  class=""><h2 id="isolate">Isolate</h2>
</section>

<section  class=""><h2 id="until-it-s-too-easy-">until it&#39;s &#39;too easy&#39;</h2>
</section>

<section data-state='title' class=" title"><h2 id="mocks-n-stubs">Mocks n stubs</h2>
</section>

<section  class=""><h2 id="both-fakes">Both fakes</h2>
</section>

<section  class=""><h2 id="roll-your-own-or-library">Roll your own, or library</h2>
<ul>
<li>sinon</li>
</ul>
</section>

<section  class=""><h2 id="mocks-function-voyeurism">Mocks: function voyeurism</h2>
<pre><code class="lang-javascript">it(&quot;should call&quot;, function(done) {
  // Faking out $.get
  $.get = function(url) {
    assert.match(url, /users\/1/)
    done();
  } 

  user.retrieve(1);
})
</code></pre>
</section>

<section  class=""><h2 id="mocks-asserting-call-behaviour">Mocks: asserting call behaviour</h2>
</section>

<section  class=""><h2 id="stubs">Stubs</h2>
<ul>
<li>replace dependencies of a unit</li>
</ul>
<pre><code class="lang-javascript">function computeAnswer(cb) {
  $.get(&quot;/answer&quot;,function(answer) {
    cb(answer + 1);
  });
}

// STUB!
$.get = function(url, cb) {
  cb(42);
}

computeAnswer(function(answer) {
  assert.equals(result,43);
});
</code></pre>
</section>

<section  class=""><h2 id="mocks-are-tests-stubs-support-tests">Mocks are tests, stubs support tests</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-of-mocks-stubs">Diagram of mocks/stubs</h2>
<p><img src="media/mocks-stubs.png"></p>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<pre><code>Exercise 2

exercises/testing
</code></pre></section>

<section data-state='title' class=" title"><h2 id="developer-tools">Developer Tools</h2>
</section>

<section  class=""><h2 id="chrome">Chrome</h2>
<ul>
<li>CPU</li>
<li>memory</li>
<li>timeline</li>
</ul>
</section>

<section  class=""><h2 id="node-js">Node.js</h2>
<ul>
<li>can be used here too, with caveats</li>
<li><code>node-debugger</code></li>
</ul>
</section>

<section  class=""><h2 id="hands-on">Hands-on</h2>
<pre><code>in Chrome, google and open &#39;ember TodoMVC&#39;
</code></pre></section>

<section data-state='title' class=" title"><h2 id="wrap-">Wrap!</h2>
</section>

<section  class=""><h2 id="thanks-">Thanks!</h2>
<p>For tips &amp; content, sign up to my mailing list:</p>
<ul>
<li><a href="http://truffles.me.uk/tips">truffles.me.uk/tips</a></li>
<li><a href="https://www.twitter.com/timruffles">@timruffles</a></li>
</ul>
</section>

</div>
</div>

<!-- demo code -->
<script src="js/jquery.js"></script>
<script src="js/lodash.js"></script>
<script src="js/angular.js"></script>

<!-- live coding -->
<script src=js/little-console.js></script>
<script src=js/showConsoles.js></script>

<!-- reveal -->
<script src="reveal/lib/js/head.min.js"></script>
<script src="reveal/plugin/highlight/highlight.js"></script>
<script src="reveal/js/reveal.js"></script>
<script src="js/revealConfig.js"></script>

</body>
